"use strict";
require.config(requireConfig),require(["jquery","tmpl","i18n","bootstrap","common"],function(r,e,s,t,a){function o(r){if(f)for(var e=0;e<f.length;e++){var s=f[e];if(s.code==r)return s.name}return r}function n(){a.dao.getUserAddress({userId:a.util.getUserId(),addrType:0},function(e){var s=e;if(s&&s.length>0)for(var t=0;t<s.length;t++)if(1==s[t].isDefault){C=s[t];break}C&&(r("#first_name_input").val(C.recFirstname),r("#last_name_input").val(C.recLastname),r("#address_input").val(C.streetAddr),r("#address_2_input").val(C.extendAddr),r("#city_input").val(C.city),r("#postal_code_input").val(C.postCode),r("#email_input").val(C.email),r("#phone_input").val(C.telephone),r("#phone_2_input").val(C.telephone1)),l()},function(){l()})}function i(){var e="";1==sessionStorage.applyCouponCode&&(e=a.util.getCouponCode());var s={currencyId:a.util.getLocalCurrency(),userId:a.util.getUserId(),cart:[],applyCpNo:e};a.dao.shoppingCart({inputParams:JSON.stringify(s)},function(e){var s=e.cart;if(s){for(var t=a.util.getCurrencySymbol(a.util.getLocalCurrency()),o=0,n=0;n<s.length;n++){var i=s[n];if(0==Number(i.productNum)?s.splice(n,1):(i.displayImg=a.util.picUrl+i.displayImg,i.cost=a.util.formatProductPrice(i.cost,t),o+=Number(i.productNum)),i.subCarts&&i.subCarts.length>0)for(var l=0;l<i.subCarts.length;l++){var d=i.subCarts[l];d.attrDes&&d.attrDes.length>0?d.displayImg=a.util.picUrl+d.displayImg:(i.subCarts.splice(l,1),l-=1)}}r("#cart_list").html(r("#cartTempl").tmpl(s)),r("#cart_list #color_title").html(r.i18n.map.ColorTitle),v=!0}else v=!1;if(e.dis_info&&e.dis_info.length>0){for(var n=0;n<e.dis_info.length;n++){var u=e.dis_info[n];u.disAmount<0?u.disAmount="-"+a.util.formatProductPrice(-u.disAmount,t):u.disAmount="+"+a.util.formatProductPrice(u.disAmount,t),6==u.policyId&&r("#ship_cost_content").html(u.disAmount)}r("#dis_info_list").html(r("#disInfoTempl").tmpl(e.dis_info))}r("#sub_total").html(a.util.formatProductPrice(e.amount,t)),r("#grand_total").html(a.util.formatProductPrice(e.realAmount,t)),c=e.amountAllowed,m=e.realAmount,_=e.minAmountAllowed;var p=3;sessionStorage.maxnum_allowed&&(p=Number(sessionStorage.maxnum_allowed)),h=o<=p})}function l(){var e=document.getElementById("countryList");p=C?C.country:sessionStorage.country_belong?sessionStorage.country_belong:e.options[0].value,r("#countryList option[value='"+p+"']").prop("selected",!0),r.getJSON("/resources/json/country.json",function(s){f=s;var t=e.value;console.log(t);for(var a=0,o=0;o<s.length;o++){if(s[o].code===t){a=o;break}}if(s&&s[a]&&s[a].state&&s[a].state.length>0)d(s[a].state,!0),r("#provice_selected_wrap").show(),r("#provice_input_wrap").hide();else{document.getElementById("provinceList").length=0,r("#provice_selected_wrap").hide(),r("#provice_input_wrap").show(),r(".loading-mask").addClass("hide")}r("#countryList").on("change",function(){var e=r(this).find("option:selected").val();p=e;for(var t=0,a=0;a<s.length;a++){if(s[a].code===p){t=a;break}}if(s&&s[t]&&s[t].state&&s[t].state.length>0)d(s[t].state,!1),r("#provice_selected_wrap").show(),r("#provice_input_wrap").hide();else{document.getElementById("provinceList").length=0,r("#provice_selected_wrap").hide(),r("#provice_input_wrap").show()}})})}function d(e,s){if(e&&e.length>0){r("#provice_selected_wrap").show(),r("#provice_input_wrap").hide();document.getElementById("provinceList").length=0;for(var t=e,a=0;a<t.length;a++){var o="<option value='"+t[a]+"'>"+t[a]+"</option>";s&&C&&C.province==t[a]&&(o="<option value='"+t[a]+"' selected>"+t[a]+"</option>"),r("#provinceList").append(o)}r(".loading-mask").addClass("hide")}else r("#provice_selected_wrap").hide(),r("#provice_input_wrap").show(),C&&r("#province_input").val(C.province),r(".loading-mask").addClass("hide")}function u(e,s){return!r(e).parent().hasClass("has-error")&&""!==r(e).val().trim()||(r(this).parent().removeClass("has-success"),r(this).parent().addClass("has-error"),r(s).parent().addClass("show-error-text"),!1)}console.log("checkout_shipping.js");var p,c="",_="",m="",h=!0,v=null,C=null,f=null,g=0;a.initLoginStatus(function(r){if(r)if(sessionStorage.country_belong)n(),i();else var e=setInterval(function(){g++,sessionStorage.country_belong?(clearInterval(e),g=0,n(),i()):g>=3&&(clearInterval(e),g=0,n(),i())},1e3);else window.location.href="../../../login.html"}),function(){r("#save_address_btn").click(function(){var e=!0,s=u("#first_name_input","#error_first_name");e&&((e=s&&e)||r("#first_name_input").focus());var t=u("#last_name_input","#error_last_name");e&&((e=t&&e)||r("#last_name_input").focus());var i=!0,l=a.util.checkAddress();0==l?(r("#address_input").parent().removeClass("has-success"),r("#address_input").parent().addClass("has-error"),r("#error_address").parent().addClass("show-error-text"),i=!1):-1==l?(r("#address_input").parent().removeClass("has-success"),r("#address_input").parent().addClass("has-error"),r("#error_address").parent().addClass("show-error-text"),i=!1):1==l&&(r("#address_input").parent().removeClass("has-error"),r("#address_input").parent().addClass("has-success"),r("#error_address").parent().removeClass("show-error-text")),e&&((e=i&&e)||r("#address_input").focus());var d=u("#city_input","#error_city");e&&((e=d&&e)||r("#city_input").focus());var c=u("#postal_code_input","#error_postal_code");e&&((e=c&&e)||r("#postal_code_input").focus());var _=u("#email_input","#error_email");e&&((e=_&&e)||r("#email_input").focus());var m=u("#phone_input","#error_phone");if(e&&((e=m&&e)||r("#phone_input").focus()),r("#provice_input_wrap").is(":visible")){var h=u("#province_input","#error_province");e&&((e=h&&e)||r("#province_input").focus())}var v=r("#provinceList").val();if(r("#provice_input_wrap").is(":visible")&&(v=r("#province_input").val()),e){var C={userId:a.util.getUserId(),country:p,fullCountry:o(p),province:v,city:r("#city_input").val(),streetAddr:r("#address_input").val(),extendAddr:r("#address_2_input").val(),email:r("#email_input").val().trim(),postCode:r("#postal_code_input").val(),isBillAddr:"0",telephone:r("#phone_input").val(),telephone1:r("#phone_2_input").val(),recFirstname:r("#first_name_input").val(),recLastname:r("#last_name_input").val()};a.dao.addAddress({inputParams:JSON.stringify(C)},function(r){n()}),r("#error_message").html(""),r("#error_message").hide(),r("#save_address_btn").attr("disabled",!0)}}),r("#cancel_save_address_btn").click(function(){r("#choose_shipping_address_wrap").show(),r("#edit_shipping_address_wrap").hide()}),r("#continue_btn, #mobile_continue_btn").click(function(){if(null!=v){if(0==v)return r("#error_message").html(r.i18n.map.EmptyCart),void r("#error_message").show();var e=!0,s=u("#first_name_input","#error_first_name");e&&((e=s&&e)||r("#first_name_input").focus());var t=u("#last_name_input","#error_last_name");e&&((e=t&&e)||r("#last_name_input").focus());var n=!0,i=a.util.checkAddress(r("#address_input").val());0==i?(r("#address_input").parent().removeClass("has-success"),r("#address_input").parent().addClass("has-error"),r("#error_address").parent().addClass("show-error-text"),n=!1):-1==i?(r("#address_input").parent().removeClass("has-success"),r("#address_input").parent().addClass("has-error"),r("#error_address").parent().addClass("show-error-text"),n=!1):1==i&&(r("#address_input").parent().removeClass("has-error"),r("#address_input").parent().addClass("has-success"),r("#error_address").parent().removeClass("show-error-text")),e&&((e=n&&e)||r("#address_input").focus()),n=!0,i=a.util.checkAddress(r("#address_2_input").val()),-1==i?(r("#address_2_input").parent().removeClass("has-success"),r("#address_2_input").parent().addClass("has-error"),r("#error_address_2").parent().addClass("show-error-text"),n=!1):(r("#address_2_input").parent().removeClass("has-error"),r("#address_2_input").parent().addClass("has-success"),r("#error_address_2").parent().removeClass("show-error-text")),e&&((e=n&&e)||r("#address_2_input").focus());var l=u("#city_input","#error_city");e&&((e=l&&e)||r("#city_input").focus());var d=u("#postal_code_input","#error_postal_code");e&&((e=d&&e)||r("#postal_code_input").focus());var f=u("#email_input","#error_email");e&&((e=f&&e)||r("#email_input").focus());var g=u("#phone_input","#error_phone");if(e&&((e=g&&e)||r("#phone_input").focus()),r("#provice_input_wrap").is(":visible")){var w=u("#province_input","#error_province");e&&((e=w&&e)||r("#province_input").focus())}var y=r("#provinceList").val();if(r("#provice_input_wrap").is(":visible")&&(y=r("#province_input").val()),h){if(m<_){var x=a.util.getCurrencySymbol(a.util.getLocalCurrency());r("#error_message").html(r.i18n.map.maxAmountErrorMsg1+" "+a.util.formatProductPrice(m,x)+" "+r.i18n.map.maxAmountErrorMsg4+" "+a.util.formatProductPrice(_,x)+". "+r.i18n.map.maxAmountErrorMsg3),r("#error_message").removeClass("hide"),setTimeout(function(){alert(r.i18n.map.maxAmountErrorMsg1+" "+a.util.formatProductPrice(m,x)+" "+r.i18n.map.maxAmountErrorMsg4+" "+a.util.formatProductPrice(_,x)+". "+r.i18n.map.maxAmountErrorMsg3)},1)}else if(m>c){var x=a.util.getCurrencySymbol(a.util.getLocalCurrency());r("#error_message").html(r.i18n.map.maxAmountErrorMsg1+" "+a.util.formatProductPrice(m,x)+" "+r.i18n.map.maxAmountErrorMsg2+" "+a.util.formatProductPrice(c,x)+". "+r.i18n.map.maxAmountErrorMsg3),r("#error_message").removeClass("hide"),setTimeout(function(){alert(r.i18n.map.maxAmountErrorMsg1+" "+a.util.formatProductPrice(m,x)+" "+r.i18n.map.maxAmountErrorMsg2+" "+a.util.formatProductPrice(c,x)+". "+r.i18n.map.maxAmountErrorMsg3)},1),e=!1}}else r("#error_message").html(r.i18n.map.maxErrorMsg1+" "+sessionStorage.maxnum_allowed+r.i18n.map.maxErrorMsg2),r("#error_message").removeClass("hide"),setTimeout(function(){alert(r.i18n.map.maxErrorMsg1+" "+sessionStorage.maxnum_allowed+r.i18n.map.maxErrorMsg2)},1),e=!1;if(e){var b={userId:a.util.getUserId(),country:p,fullCountry:o(p),province:y,city:r("#city_input").val(),streetAddr:r("#address_input").val(),extendAddr:r("#address_2_input").val(),email:r("#email_input").val().trim(),postCode:r("#postal_code_input").val(),telephone:r("#phone_input").val(),telephone1:r("#phone_2_input").val(),recFirstname:r("#first_name_input").val(),recLastname:r("#last_name_input").val()};C&&(b.addrId=C.addrId),r(".loading-mask").removeClass("hide"),r("#error_message").html(""),r("#error_message").hide(),r("#continue_btn").attr("disabled",!0);var A="";1==sessionStorage.applyCouponCode&&(A=a.util.getCouponCode());var I="",P="",k=a.util.getAdvSource();k&&(I=k.t,P=k.u);var E={};E=I&&"null"!==I&&"undefined"!==I?{currencyId:a.util.getLocalCurrency(),userId:a.util.getUserId(),adsType:I,adsAccount:P,memo:r("#memo_text_area").val(),spAddr:b,applyCpNo:A}:{currencyId:a.util.getLocalCurrency(),userId:a.util.getUserId(),adsAccount:P,memo:r("#memo_text_area").val(),spAddr:b,applyCpNo:A},a.dao.newOrder({inputParams:JSON.stringify(E)},function(e){e&&(r(".loading-mask").addClass("hide"),r("#continue_btn").attr("disabled",!1),window.location.href="checkout_payment.html?orderId="+e.orderId)},function(e){r(".loading-mask").addClass("hide"),r("#error_message").html(e.msg),r("#error_message").show(),setTimeout(function(){alert(e.msg)})},function(){r(".loading-mask").addClass("hide"),r("#continue_btn").attr("disabled",!1)})}}}),a.util.isMobile()&&r(window).scroll(function(){a.util.isElementInViewport(document.getElementById("continue_btn"))?r("#mobile_continue_btn").addClass("hide"):r("#mobile_continue_btn").removeClass("hide")})}(),function(){var e=sessionStorage.userInfo;e&&(e=JSON.parse(e),r("#first_name_input").val(e.firstName),r("#last_name_input").val(e.lastName),r("#email_input").val(e.email)),r("#first_name_input").blur(function(){var e=a.util.checkNull(r(this).val());0==e?(r(this).parent().removeClass("has-success"),r(this).parent().addClass("has-error"),r("#error_first_name").parent().addClass("show-error-text")):1==e&&(r(this).parent().removeClass("has-error"),r(this).parent().addClass("has-success"),r("#error_first_name").parent().removeClass("show-error-text"))}),r("#last_name_input").blur(function(){var e=a.util.checkNull(r(this).val());0==e?(r(this).parent().removeClass("has-success"),r(this).parent().addClass("has-error"),r("#error_last_name").parent().addClass("show-error-text")):1==e&&(r(this).parent().removeClass("has-error"),r(this).parent().addClass("has-success"),r("#error_last_name").parent().removeClass("show-error-text"))}),r("#address_input").blur(function(){var e=a.util.checkAddress(r(this).val());0==e?(r(this).parent().removeClass("has-success"),r(this).parent().addClass("has-error"),r("#error_address").parent().addClass("show-error-text")):-1==e?(r(this).parent().removeClass("has-success"),r(this).parent().addClass("has-error"),r("#error_address").parent().addClass("show-error-text")):1==e&&(r(this).parent().removeClass("has-error"),r(this).parent().addClass("has-success"),r("#error_address").parent().removeClass("show-error-text"))}),r("#address_2_input").blur(function(){-1==a.util.checkAddress(r(this).val())?(r(this).parent().removeClass("has-success"),r(this).parent().addClass("has-error"),r("#error_address_2").parent().addClass("show-error-text")):(r(this).parent().removeClass("has-error"),r(this).parent().addClass("has-success"),r("#error_address_2").parent().removeClass("show-error-text"))}),r("#postal_code_input").blur(function(){var e=a.util.checkNull(r(this).val());0==e?(r(this).parent().removeClass("has-success"),r(this).parent().addClass("has-error"),r("#error_postal_code").parent().addClass("show-error-text")):1==e&&(r(this).parent().removeClass("has-error"),r(this).parent().addClass("has-success"),r("#error_postal_code").parent().removeClass("show-error-text"))}),r("#city_input").blur(function(){var e=a.util.checkNull(r(this).val());0==e?(r(this).parent().removeClass("has-success"),r(this).parent().addClass("has-error"),r("#error_city").parent().addClass("show-error-text")):1==e&&(r(this).parent().removeClass("has-error"),r(this).parent().addClass("has-success"),r("#error_city").parent().removeClass("show-error-text"))}),r("#province_input").blur(function(){var e=a.util.checkNull(r(this).val());0==e?(r(this).parent().removeClass("has-success"),r(this).parent().addClass("has-error"),r("#error_province").parent().addClass("show-error-text")):1==e&&(r(this).parent().removeClass("has-error"),r(this).parent().addClass("has-success"),r("#error_province").parent().removeClass("show-error-text"))}),r("#email_input").blur(function(){var e=a.util.checkEmail(r(this).val().trim());0==e?(r(this).parent().removeClass("has-success"),r(this).parent().addClass("has-error"),r("#error_email").parent().addClass("show-error-text")):-1==e?(r(this).parent().removeClass("has-success"),r(this).parent().addClass("has-error"),r("#error_email").parent().addClass("show-error-text")):1==e&&(r(this).parent().removeClass("has-error"),r(this).parent().addClass("has-success"),r("#error_email").parent().removeClass("show-error-text"))}),r("#phone_input").blur(function(){var e=a.util.checkPhone(r(this).val());0==e?(r(this).parent().removeClass("has-success"),r(this).parent().addClass("has-error"),r("#error_phone").parent().addClass("show-error-text")):-1==e?(r(this).parent().removeClass("has-success"),r(this).parent().addClass("has-error"),r("#error_phone").parent().addClass("show-error-text")):1==e&&(r(this).parent().removeClass("has-error"),r(this).parent().addClass("has-success"),r("#error_phone").parent().removeClass("show-error-text"))})}(),function(){a.dao.getChannel({type:1},function(r){r&&sessionStorage.setItem("channelList",JSON.stringify(r))})}(),r(".loading-mask").removeClass("hide"),r("#currency_group").hide()});